<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Young+Serif&display=swap" rel="stylesheet">
  <title>Frontend Mentor | Recipe page</title>
  <link rel="stylesheet" href="style.css">
</head>
  <body>
    <main class="main">
      <img class="omelette" src="./image-omelette.jpeg" alt="Omelette">

      <h1 class="title" id="recipeTitle">Loading...</h1>

      <a href="user-recipes.html?userId=${recipe.user_id}" class="recipe-author" id="recipeAuthor">Loading...</a>

      <p class="description" id="descriptionText">Loading...</p>

      <section class="prep-time">
        <h2 class="prep-time-title">Preparation time</h2>

        <ul>
          <li><span class="bullet-space" id="totalTime">Loading...</span></li>
          <li><span class="bullet-space" id="prepTime">Loading...</span></li>
          <li><span class="bullet-space" id="cookTime">Loading...</span></li>
          <li><span class="bullet-space" id="servings">Loading...</span></li>
        </ul>
      </section>

      <h2 class="sub-heading">Ingredients</h2>

      <ul id="ingredientsList"></ul>

      <div class="hr"></div>

      <h2 class="sub-heading">Instructions</h2>

      <ol id="instructionsList"></ol>

      <div class="hr"></div>

      <h2 class="sub-heading">Nutrition</h2>

      <p>The table below shows nutritional values per 
        serving without the additional fillings.
      </p>

      <table>
        <tr>
          <td class="nutrient">Calories</td>
          <td class="nutrient-value">277kcal</td>
        </tr>
        <tr class="divider-row"><td colspan="2"></td></tr>
        <tr>
          <td class="nutrient">Carbs</td>
          <td class="nutrient-value">0g</td>
        </tr>
        <tr class="divider-row"><td colspan="2"></td></tr>
        <tr>
          <td class="nutrient">Protein</td>
          <td class="nutrient-value">20g</td>
        </tr>
        <tr class="divider-row"><td colspan="2"></td></tr>
        <tr>
          <td class="nutrient">Fat</td>
          <td class="nutrient-value">22g</td>
        </tr>
      </table>

      <div id="ownerActions" class="hidden">
        <button id="editBtn" class="btn btn-edit">Edit Recipe</button>
        <button id="deleteBtn" class="btn btn-delete">Delete Recipe</button>
      </div>
      
      <!-- <div class="attribution">
        Challenge by <a href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>. 
        Coded by <a href="#">Your Name Here</a>.
      </div> -->
    </main>
    <script>
        const API_URL = 'http://localhost:3000'

        // Get the recipe ID from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const recipeId = urlParams.get('id');

        console.log("Recipe ID:", recipeId);
        console.log("Full URL:", window.location.search);

        // Fetch the recipe
        async function loadRecipe() {
            try {
                const response = await fetch(`${API_URL}/api/recipes/${recipeId}`);
                const recipe = await response.json();
                console.log("Got recipe:", recipe);

                // Update title
                document.getElementById('recipeTitle').textContent = recipe.title || 'Untitled Recipe';

                document.getElementById('recipeAuthor').textContent = 
                  recipe.author ? `By ${recipe.author}` : 'By Unknown Author';

                document.getElementById('descriptionText').textContent = recipe.category_name;

                // Update quantities
                document.getElementById('totalTime').innerHTML = `<strong>Total</strong>: Approximately ${recipe.prep_time + recipe.cook_time} minutes`;
                document.getElementById('prepTime').innerHTML = `<strong>Preparation</strong>: ${recipe.prep_time} minutes`;
                document.getElementById('cookTime').innerHTML = `<strong>Cooking</strong>: ${recipe.cook_time} minutes`;
                document.getElementById('servings').innerHTML = `<strong>Servings</strong>: ${recipe.servings}`;
                
                // Update Ingredients
                const ingredientsArray = recipe.ingredients.split(', ');
                const ingredientsHTML = ingredientsArray
                  .map(ingredient => `<li><span class="bullet-space">${ingredient}</span></li>`)
                  .join('');

                document.getElementById('ingredientsList').innerHTML = ingredientsHTML;

                // Update Instructions
                const instructionsArray = recipe.instructions.split(', ');
                const instructionsHTML = instructionsArray
                  .map(instruction => `<li>${instruction}</li>`)
                  .join('');

                  document.getElementById('instructionsList').innerHTML = instructionsHTML;
            } catch (error) {
                console.log("Error:", error);
                document.getElementById('recipeTitle').textContent = "Error loading recipe";
            }
        }

        // Run it!
        loadRecipe();
    </script>
  </body>
</html>


<!-- // Update Ingredients
const ingredientsArray = recipe.ingredients.split(', ');

let ingredientsHTML = '';
ingredientsArray.forEach(ingredient => {
  ingredientsHTML += `<li><span class="bullet-space">${ingredient}</span></li>`;
});

document.getElementById('ingredientsList').innerHTML = ingredientsHTML; -->


<!-- const token = localStorage.getItem('token');
if (token) {
    // User is logged in!
} -->

<!-- if (recipe.user_id === currentUser.id) {
    // This user owns this recipe!
} -->